# Implementation Plan: Horizontal Tabs Navigation in Top Bar

**Branch**: `023-top-bar-with-tabs` | **Date**: 2026-01-13 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/023-top-bar-with-tabs/spec.md`

## Summary

Move event designer navigation from a vertical sidebar to horizontal tabs in the TopNavBar component. This includes:
1. Extending TopNavBar to support an optional tabs row
2. Creating a reusable NavTabs component
3. Swapping the controls/preview layout in editor pages (controls on left, preview on right)
4. Centering content on the Settings page
5. Renaming control panel components for naming consistency (WelcomeControls → WelcomeConfigPanel, ThemeControls → ThemeConfigPanel)

## Technical Context

**Language/Version**: TypeScript 5.7.2 (strict mode, ES2022 target)
**Primary Dependencies**: TanStack Start 1.132.0, TanStack Router 1.132.0, React 19.2.0, Tailwind CSS v4
**Storage**: N/A (no data layer changes)
**Testing**: Vitest
**Target Platform**: Web application (desktop-first for admin dashboard)
**Project Type**: Web application (monorepo with apps/clementine-app)
**Performance Goals**: Page load < 2 seconds, navigation transitions < 100ms
**Constraints**: Mobile-first design principles apply, must use design tokens
**Scale/Scope**: 3 tabs (Welcome, Theme, Settings), affects 8 components (including 2 renames)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Mobile-First Design | ✅ PASS | Tabs will be responsive, horizontal scrolling on narrow viewports |
| II. Clean Code & Simplicity | ✅ PASS | Minimal changes, reusing existing patterns from EventDesignerSidebar |
| III. Type-Safe Development | ✅ PASS | All new code will be fully typed, no `any` |
| IV. Minimal Testing Strategy | ✅ PASS | Unit tests for new NavTabs component |
| V. Validation Gates | ✅ PASS | Will run `pnpm app:check` before commit, review design-system.md |
| VI. Frontend Architecture | ✅ PASS | Client-side only, no server code needed |
| VII. Backend & Firebase | ✅ N/A | No backend changes |
| VIII. Project Structure | ✅ PASS | NavTabs goes in navigation domain, follows vertical slice |

**Gate Result**: ✅ PASS - All applicable principles satisfied

## Project Structure

### Documentation (this feature)

```text
specs/023-top-bar-with-tabs/
├── spec.md              # Feature specification
├── plan.md              # This file (implementation plan)
├── research.md          # Research findings
├── data-model.md        # N/A (no data model changes)
├── quickstart.md        # Developer quickstart
└── tasks.md             # Task breakdown (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
apps/clementine-app/src/
├── domains/
│   ├── navigation/
│   │   └── components/
│   │       ├── TopNavBar.tsx          # MODIFY: Add tabs prop
│   │       ├── NavTabs.tsx            # NEW: Navigation tabs component
│   │       └── index.ts               # MODIFY: Export NavTabs
│   └── event/
│       ├── designer/
│       │   ├── components/
│       │   │   └── EventDesignerSidebar.tsx  # DEPRECATE (may remove)
│       │   └── containers/
│       │       ├── EventDesignerLayout.tsx   # MODIFY: Pass tabs to TopNavBar
│       │       └── EventDesignerPage.tsx     # MODIFY: Remove sidebar
│       ├── welcome/
│       │   ├── components/
│       │   │   └── WelcomeConfigPanel.tsx    # RENAME: from WelcomeControls.tsx
│       │   └── containers/
│       │       └── WelcomeEditorPage.tsx     # MODIFY: Swap column order, update import
│       ├── theme/
│       │   ├── components/
│       │   │   └── ThemeConfigPanel.tsx      # RENAME: from ThemeControls.tsx
│       │   └── containers/
│       │       └── ThemeEditorPage.tsx       # MODIFY: Swap column order, update import
│       └── settings/
│           └── containers/
│               └── EventSettingsPage.tsx     # MODIFY: Center content
└── shared/
    └── ... (no changes)
```

**Structure Decision**: Web application structure with vertical slice architecture. All changes are within the existing domain structure.

## Complexity Tracking

> No violations - all changes follow existing patterns and principles.

| Aspect | Approach | Why Simple |
|--------|----------|------------|
| Tab component | Custom NavTabs with Links | Reuses existing patterns from EventDesignerSidebar |
| Active detection | useMatchRoute hook | Already proven in EventDesignerSidebar |
| Layout swap | JSX reordering | No structural changes, just order |
| Centered layout | Tailwind utilities | Standard pattern |
| Component renames | File rename + find/replace | No logic changes, just naming consistency |

## Design Decisions

### 1. NavTabs Component

**Location**: `src/domains/navigation/components/NavTabs.tsx`

**Interface**:
```typescript
export interface TabItem {
  id: string
  label: string
  to: string  // TanStack Router path pattern
}

export interface NavTabsProps {
  tabs: TabItem[]
  className?: string
}
```

**Behavior**:
- Renders horizontal list of tab links
- Uses TanStack Router `Link` for navigation
- Uses `useMatchRoute` for active state detection
- Active tab has underline indicator (border-b-2 border-primary)
- Uses design tokens for all styling

### 2. TopNavBar Extension

**Changes to TopNavBarProps**:
```typescript
export interface TopNavBarProps {
  breadcrumbs: BreadcrumbItem[]
  tabs?: TabItem[]  // NEW - optional
  left?: React.ReactNode
  right?: React.ReactNode
  className?: string
}
```

**Rendering Logic**:
- If `tabs` prop is provided, render two rows:
  - Row 1: Breadcrumbs + left + right content
  - Row 2: NavTabs component
- If `tabs` is not provided, render single row (backward compatible)

### 3. EventDesignerLayout Integration

**Tab Configuration**:
```typescript
const eventDesignerTabs: TabItem[] = [
  { id: 'welcome', label: 'Welcome', to: '/workspace/$workspaceSlug/projects/$projectId/events/$eventId/welcome' },
  { id: 'theme', label: 'Theme', to: '/workspace/$workspaceSlug/projects/$projectId/events/$eventId/theme' },
  { id: 'settings', label: 'Settings', to: '/workspace/$workspaceSlug/projects/$projectId/events/$eventId/settings' },
]
```

### 4. Editor Page Layout Changes

**WelcomeEditorPage & ThemeEditorPage**:
- Current: Preview (left) | Controls (right)
- New: Controls (left) | Preview (right)
- Implementation: Swap JSX order, change `border-l` to `border-r` on controls

**EventSettingsPage**:
- Current: Full-width content with padding
- New: Centered content with max-width
- Implementation: Wrap in flex container with `justify-center` and `max-w-3xl`

## Implementation Phases

### Phase 1: NavTabs Component
1. Create `NavTabs.tsx` in navigation domain
2. Implement tab rendering with Links
3. Add active state detection
4. Style using design tokens
5. Export from navigation index

### Phase 2: TopNavBar Extension
1. Add `tabs` prop to TopNavBarProps
2. Conditionally render second row with NavTabs
3. Maintain backward compatibility
4. Update navigation index exports

### Phase 3: EventDesigner Integration
1. Define tab configuration in EventDesignerLayout
2. Pass tabs to TopNavBar
3. Remove EventDesignerSidebar from EventDesignerPage
4. Update EventDesignerPage layout

### Phase 4: Editor Page Layouts & Component Renames
1. Rename WelcomeControls.tsx → WelcomeConfigPanel.tsx
2. Update WelcomeConfigPanel component name and exports
3. Update WelcomeEditorPage: swap column order, update import
4. Rename ThemeControls.tsx → ThemeConfigPanel.tsx
5. Update ThemeConfigPanel component name and exports
6. Update ThemeEditorPage: swap column order, update import
7. Update EventSettingsPage to centered layout
8. Update barrel exports in welcome/components/index.ts and theme/components/index.ts

### Phase 5: Cleanup & Validation
1. Run validation gates (`pnpm app:check`)
2. Review against design-system.md
3. Test all navigation flows
4. Consider removing unused EventDesignerSidebar

## Success Criteria Verification

| Criterion | Verification Method |
|-----------|---------------------|
| SC-001: Navigate using tabs | Manual test: click each tab, verify navigation |
| SC-002: All functionality accessible | Manual test: verify all editor features work |
| SC-003: Page load < 200ms baseline | Measure with DevTools, compare to current |
| SC-004: Visual consistency | Review against design system tokens |
| SC-005: Active tab visible < 1s | Manual test: observe active state on load |

## Dependencies

- No new npm packages required
- Uses existing TanStack Router, Tailwind CSS, design tokens
- All functionality available in current codebase
