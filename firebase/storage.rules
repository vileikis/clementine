rules_version = '2';

// Firebase Storage Security Rules for Clementine
// Auth System: Admin users have full access, anonymous users can read workspaces

service firebase.storage {
  match /b/{bucket}/o {

    // Helper function: Check if user is admin
    function isAdmin() {
      return request.auth != null
        && request.auth.token.admin == true;
    }

    function isAnyUser() {                                                                                                               
      return request.auth != null;                                                                                                       
    }    

    // Workspace storage: Anonymous users can read, admins can read/write
    match /workspaces/{workspaceId}/{allPaths=**} {
      allow read: if isAnyUser(); // Any authenticated user (including anonymous)
      allow write: if isAdmin(); // Only admins can write
    }

    // All other paths: Admins only
    match /{allPaths=**} {
      allow read, write: if isAdmin();
    }
  }
}
