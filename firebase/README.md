# Firebase Configuration

This directory contains all Firebase-related configuration files for the Clementine project.

## Files

### Security Rules

- **`firestore.rules`** - Firestore database security rules
  - Controls read/write access to Firestore collections
  - POC: Allow all reads, deny all writes (force Server Actions)
  - See file comments for future MVP rules examples

- **`storage.rules`** - Firebase Storage security rules
  - Controls access to uploaded images and files
  - POC: Allow all reads, deny all writes (force Server Actions)
  - See file comments for future MVP rules examples

### Configuration

- **`firestore.indexes.json`** - Firestore composite indexes
  - Auto-generated by Firebase CLI
  - Defines indexes for complex queries
  - Empty for POC (Firebase creates single-field indexes automatically)

## Deployment

Deploy rules from the **root directory**:

```bash
# Deploy only security rules
pnpm firebase:deploy:rules

# Deploy everything (rules + indexes + functions)
pnpm firebase:deploy
```

## Security Strategy (POC)

The POC uses a **hybrid Client SDK + Admin SDK** approach:

### Client SDK (Frontend)
- ✅ Can **read** documents (for real-time subscriptions)
- ❌ **Cannot write** (all mutations via Server Actions)

### Admin SDK (Server Actions)
- ✅ Full read/write access with privileged credentials
- ✅ Business logic and validation enforced server-side
- ✅ Secure - runs only on the server

### Why This Approach?

1. **Real-time updates work** - Guest flow can subscribe to session changes
2. **Security enforced** - All mutations go through validated Server Actions
3. **Business logic secure** - No way to bypass validation from client
4. **Easy to tighten** - Add authentication and user-specific rules in MVP

## Future: MVP Rules

When authentication is added, the rules will be updated to:

- **Events**: Only organizers can write their own events
- **Sessions**: Guests can read their own sessions
- **Storage**: Reference images restricted to organizers
- **Analytics**: Only organizers can view their event stats

See commented examples in the rules files.

## Testing Rules Locally

Use the Firebase Emulator Suite to test rules locally:

```bash
# Start emulators (from root directory)
firebase emulators:start

# Emulator UI available at http://localhost:4000
# - Firestore: localhost:8080
# - Storage: localhost:9199
```

## Resources

- [Firestore Security Rules Documentation](https://firebase.google.com/docs/firestore/security/get-started)
- [Storage Security Rules Documentation](https://firebase.google.com/docs/storage/security)
- [Firebase Emulator Suite](https://firebase.google.com/docs/emulator-suite)
